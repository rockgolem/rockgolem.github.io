<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Game Dev Diary: Infrastructure Journey | Rock Golem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="We’ve been talking about design and game mechanics, and you’ve seen the progress we’ve been making with the client. In this post, we’re going to take a peek under the hood and explore how the game ser">
<meta property="og:type" content="article">
<meta property="og:title" content="Game Dev Diary: Infrastructure Journey">
<meta property="og:url" content="https://blog.rockgolem.com/Game-Dev-Diary/Infrastructure-Journey.html">
<meta property="og:site_name" content="Rock Golem">
<meta property="og:description" content="We’ve been talking about design and game mechanics, and you’ve seen the progress we’ve been making with the client. In this post, we’re going to take a peek under the hood and explore how the game ser">
<meta property="og:image" content="https://blog.rockgolem.com/img/event-graph.png">
<meta property="og:updated_time" content="2016-04-20T14:08:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Game Dev Diary: Infrastructure Journey">
<meta name="twitter:description" content="We’ve been talking about design and game mechanics, and you’ve seen the progress we’ve been making with the client. In this post, we’re going to take a peek under the hood and explore how the game ser">
<meta name="twitter:creator" content="@rockgolemgames">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,400italic|Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo"></i><span class="site-title">Rock Golem</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="https://community.rockgolem.com">Community</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/golem.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://blog.rockgolem.com"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="https://community.rockgolem.com">Community</a></td>
      
        <td><a class="main-nav-link" href="/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://blog.rockgolem.com"></form>
      </td>
      </tr>
    </table>
  </div>
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="/css/images/golem.png">
      <h2 id="name">Rock Golem</h2>
      <h3 id="title">Indie Game Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Florida, USA</span>
      <a id="follow" href="https://twitter.com/rockgolemgames">FOLLOW</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        8
        <span>posts</span>
      </div>
      <div class="article-info-block">
        16
        <span>tags</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="http://github.com/rockgolem" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="https://twitter.com/rockgolemgames" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="https://www.facebook.com/rockgolemgames" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
        
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    
  </div>
</aside>
      <section id="main"><article id="post-Infrastructure-Journey" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      
	
		<img src="/img/infrastructure-overview.png" class="article-banner">
	



    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Game Dev Diary: Infrastructure Journey
    </h1>
  

        <div class="article-meta">
          
    <div class="article-author">
        <i class="fa fa-user"></i>
        <span>Chris Saylor</span>
    </div>


          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/Game-Dev-Diary/Infrastructure-Journey.html">
    <time datetime="2016-04-20T14:08:00.000Z" itemprop="datePublished">2016-04-20</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Game-Dev-Diary/">Game Dev Diary</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We’ve been talking about design and game mechanics, and you’ve seen the progress we’ve been making with the client. In this post, we’re going to take a peek under the hood and explore how the game servers are put together and how we plan to scale them up.</p>
<a id="more"></a>
<h2 id="The_Stack">The Stack</h2><p>First things first, our server code runs on <a href="https://nodejs.org" target="_blank" rel="external">Node.js</a>. As you can see from the above diagram, we are running the application in a microservice architecture. We have a relatively large number of small game services that each perform specific tasks. For example, when you request to join a multiplayer game, the <code>matchmaker</code> service is responsible for finding a game for you. </p>
<p>Our microservices run in <a href="https://www.docker.com/" target="_blank" rel="external">Docker Containers</a> making them easy to deploy and spin up additional service instances on demand. All of the services communicate in an asynchronous fashion via a message queue application called <a href="https://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a>.</p>
<p>Finally, each service stores data that it cares about in <a href="https://www.mongodb.org/" target="_blank" rel="external">MongoDB</a> and <a href="http://redis.io/" target="_blank" rel="external">Redis</a>.</p>
<p>During our upcoming alpha phase, we’ll be deploying on small instances on a VPS like <a href="https://www.digitalocean.com/" target="_blank" rel="external">DigitalOcean</a>, however during the beta (and ultimately after release), we’ll be deploying to <a href="http://aws.amazon.com/" target="_blank" rel="external">AWS</a> or <a href="https://cloud.google.com/compute/" target="_blank" rel="external">GCE</a>. It’s very simple for us to deploy in virtually any cloud computing service due to our container infrastructure.</p>
<p>Read more about the <a href="http://stackshare.io/cjsaylor/rockgolem" target="_blank" rel="external">details of our stack</a>.</p>
<h2 id="We_don’t_ask_our_servers,_we_tell_them-">We don’t ask our servers, we tell them.</h2><p>The principle mechanism that makes our architecture so scalable is our asynchronous message queue and websocket connections. Instead of making a request to the server and waiting on a response before proceeding, we tell the server what the player did over a socket connection and react to messages from the server telling us what it did. This allows us to do a lot of tricks on the client side to hide any latency a player might experience. In addition, all of the services have an option to react to each event in their own way.</p>
<p>This also makes it so each service can have a “local” (read: local in region) database which allows us to scale horizontally almost infinetly (or until we reach RabbitMQs limits). Each service is listening to all events, which means the individual service can store only the information it needs. You can see all of the events we process in the following graph:</p>
<p><img src="/img/event-graph.png" alt="All events emitted and listened to by all game services."></p>
<p><a href="https://twitter.com/young_steveo" target="_blank" rel="external">Stephen</a> made a very nifty <a href="http://gruntjs.com/" target="_blank" rel="external">Grunt</a> task that scans the source code and generates a <a href="https://en.wikipedia.org/wiki/Graphviz" target="_blank" rel="external"><code>.dot</code> file</a> that rendered the graph above.</p>
<hr>
<p>That’s it for now. Next time, we’ll talk about how we secure the communication between the client and the server.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.rockgolem.com/Game-Dev-Diary/Infrastructure-Journey.html" data-id="cioli80en001bl00r52rhe1le" class="article-share-link">Share</a>
      
        <a href="https://blog.rockgolem.com/Game-Dev-Diary/Infrastructure-Journey.html#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/containers/">containers</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/development/">development</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/infrastructure/">infrastructure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ops/">ops</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/Game-Dev-Diary/Game-Dev-Diary-Concerning-Timers.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Game Dev Diary: Concerning Timers
        
      </div>
    </a>
  
  
    <a href="/Game-Dev-Diary/Scrolls-Runes-and-Dice.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Game Dev Diary: Scrolls, Runes, and Dice</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">recents</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/Game-Dev-Diary/Game-Dev-Diary-Concerning-Timers.html" class="thumbnail">
  
    <span style="background-image:url(/img/timers_header.jpg)" alt="Game Dev Diary: Concerning Timers" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Game-Dev-Diary/">Game Dev Diary</a></p>
              <p class="item-title"><a href="/Game-Dev-Diary/Game-Dev-Diary-Concerning-Timers.html" class="title">Game Dev Diary: Concerning Timers</a></p>
              <p class="item-date"><time datetime="2016-05-23T17:49:31.000Z" itemprop="datePublished">2016-05-23</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/Game-Dev-Diary/Infrastructure-Journey.html" class="thumbnail">
  
    <span style="background-image:url(/img/infrastructure-overview.png)" alt="Game Dev Diary: Infrastructure Journey" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Game-Dev-Diary/">Game Dev Diary</a></p>
              <p class="item-title"><a href="/Game-Dev-Diary/Infrastructure-Journey.html" class="title">Game Dev Diary: Infrastructure Journey</a></p>
              <p class="item-date"><time datetime="2016-04-20T14:08:00.000Z" itemprop="datePublished">2016-04-20</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/Game-Dev-Diary/Scrolls-Runes-and-Dice.html" class="thumbnail">
  
    <span style="background-image:url(/img/smite-scroll.jpg)" alt="Game Dev Diary: Scrolls, Runes, and Dice" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Game-Dev-Diary/">Game Dev Diary</a></p>
              <p class="item-title"><a href="/Game-Dev-Diary/Scrolls-Runes-and-Dice.html" class="title">Game Dev Diary: Scrolls, Runes, and Dice</a></p>
              <p class="item-date"><time datetime="2016-04-10T14:08:00.000Z" itemprop="datePublished">2016-04-10</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/Game-Design/The-Deck-Building-Mechanic.html" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Game-Design/">Game Design</a></p>
              <p class="item-title"><a href="/Game-Design/The-Deck-Building-Mechanic.html" class="title">The Deck Building Mechanic</a></p>
              <p class="item-date"><time datetime="2016-03-23T04:27:42.000Z" itemprop="datePublished">2016-03-23</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/Game-Design/Procedurally-Generated-Cards-in-Witches-and-Warlocks.html" class="thumbnail">
  
    <span style="background-image:url(/img/mog-mask.jpg)" alt="Procedurally Generated Cards in Witches and Warlocks" class="thumbnail-image"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Game-Design/">Game Design</a></p>
              <p class="item-title"><a href="/Game-Design/Procedurally-Generated-Cards-in-Witches-and-Warlocks.html" class="title">Procedurally Generated Cards in Witches and Warlocks</a></p>
              <p class="item-date"><time datetime="2016-03-22T22:12:42.000Z" itemprop="datePublished">2016-03-22</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Game-Design/">Game Design</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Game-Dev-Diary/">Game Dev Diary</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/News/">News</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blogging/">blogging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cards/">cards</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/containers/">containers</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deck-building/">deck building</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/">design</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/development/">development</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dice/">dice</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/first-post/">first post</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/infrastructure/">infrastructure</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mechanic/">mechanic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ops/">ops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proceedural/">proceedural</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rules/">rules</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/runes/">runes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scrolls/">scrolls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timers/">timers</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/blogging/" style="font-size: 10px;">blogging</a> <a href="/tags/cards/" style="font-size: 16.67px;">cards</a> <a href="/tags/containers/" style="font-size: 10px;">containers</a> <a href="/tags/deck-building/" style="font-size: 10px;">deck building</a> <a href="/tags/design/" style="font-size: 20px;">design</a> <a href="/tags/development/" style="font-size: 16.67px;">development</a> <a href="/tags/dice/" style="font-size: 10px;">dice</a> <a href="/tags/first-post/" style="font-size: 10px;">first post</a> <a href="/tags/infrastructure/" style="font-size: 13.33px;">infrastructure</a> <a href="/tags/mechanic/" style="font-size: 10px;">mechanic</a> <a href="/tags/ops/" style="font-size: 10px;">ops</a> <a href="/tags/proceedural/" style="font-size: 10px;">proceedural</a> <a href="/tags/rules/" style="font-size: 10px;">rules</a> <a href="/tags/runes/" style="font-size: 10px;">runes</a> <a href="/tags/scrolls/" style="font-size: 10px;">scrolls</a> <a href="/tags/timers/" style="font-size: 10px;">timers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
      </ul>
    </div>
  </div>


  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Rock Golem<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script>
  var disqus_shortname = 'rockgolem';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>